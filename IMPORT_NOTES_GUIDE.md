# 批次匯入筆記到 Pinecone 使用指南

## 目的
將 Airtable 中現有的筆記批次匯入到 Pinecone 向量資料庫，啟用智慧搜尋功能。

---

## 使用時機

### 何時需要執行此腳本？

1. **首次啟用智慧搜尋**
   - 您之前已經建立了很多筆記
   - 但這些筆記還沒有加入 Pinecone
   - 智慧搜尋找不到這些舊筆記

2. **修復後的一次性匯入**
   - 我們剛修復了自動加入 Pinecone 的功能
   - 修復前建立的筆記需要手動匯入

3. **Pinecone 資料庫重建**
   - 如果 Pinecone 資料庫被清空或重建
   - 需要重新匯入所有筆記

---

## 使用步驟

### 步驟 1：確認環境

確保您的 `.env` 檔案包含以下 API Keys：
- `GEMINI_API_KEY`
- `PINECONE_API_KEY`
- `AIRTABLE_API_KEY`
- `AIRTABLE_BASE_ID`

### 步驟 2：執行腳本

在專案目錄開啟終端機，執行：

```bash
python import_notes_to_pinecone.py
```

### 步驟 3：觀察進度

腳本會顯示類似以下的輸出：

```
============================================================
📦 批次匯入筆記到 Pinecone 向量資料庫
============================================================

🔍 處理使用者：九水
  📝 找到 25 則筆記
  ✅ [1/25] 已匯入：民法總則重點整理
  ✅ [2/25] 已匯入：刑法構成要件分析
  ⏭️ [3/25] 跳過：測試（內容太短）
  ✅ [4/25] 已匯入：憲法基本權利
  ...

🔍 處理使用者：使用者A
  ℹ️ 使用者A 沒有筆記

============================================================
📊 匯入統計
============================================================
總筆記數：25
✅ 成功匯入：23
❌ 匯入失敗：0
⏭️ 跳過（內容太短）：2
============================================================

🎉 匯入完成！現在可以使用智慧搜尋功能了！
```

---

## 腳本功能說明

### 自動處理所有使用者
- 九水
- 使用者A
- 使用者B
- 使用者C
- 使用者D

### 智慧跳過
- 內容太短的筆記（少於 10 個字元）會自動跳過
- 避免無意義的測試筆記污染搜尋結果

### 錯誤處理
- 單一筆記匯入失敗不會中斷整個流程
- 會顯示錯誤訊息並繼續處理下一則

### API 限制保護
- 每則筆記之間延遲 0.1 秒
- 避免觸發 Pinecone API 限制

---

## 驗證匯入結果

### 方法 1：查看終端機輸出
檢查「成功匯入」的數量是否符合預期

### 方法 2：使用智慧搜尋
1. 啟動 Streamlit：`streamlit run app.py`
2. 到「智慧搜尋」頁面
3. 搜尋您知道存在的筆記關鍵字
4. 應該能找到結果了！

### 方法 3：檢查 Pinecone Dashboard
1. 登入 https://www.pinecone.io/
2. 查看您的 Index
3. 檢查 Vector Count 是否增加

---

## 常見問題

### Q: 執行腳本會重複匯入嗎？
A: 會的。Pinecone 不會自動去重，每次執行都會新增向量。建議只執行一次。

### Q: 如果匯入失敗怎麼辦？
A: 
1. 檢查錯誤訊息
2. 確認 API Keys 正確
3. 確認網路連線正常
4. 可以重新執行腳本

### Q: 匯入需要多久？
A: 取決於筆記數量：
- 10 則筆記：約 5-10 秒
- 100 則筆記：約 1-2 分鐘
- 1000 則筆記：約 10-15 分鐘

### Q: 可以中途停止嗎？
A: 可以按 `Ctrl+C` 中斷。已匯入的筆記會保留在 Pinecone 中。

### Q: 匯入後新筆記還需要手動匯入嗎？
A: 不需要！修復後，新建立的筆記會自動加入 Pinecone。

---

## 注意事項

### ⚠️ 重要提醒

1. **只需執行一次**
   - 這是一次性的匯入腳本
   - 不要重複執行，否則會有重複的向量

2. **確保 API Keys 正確**
   - 特別是 Pinecone API Key
   - 錯誤的 Key 會導致匯入失敗

3. **網路連線**
   - 匯入過程需要穩定的網路連線
   - 建議在網路良好的環境下執行

4. **備份資料**
   - 雖然腳本只讀取 Airtable，不會修改
   - 但建議先備份重要資料

---

## 執行後的效果

### ✅ 智慧搜尋可用
- 可以搜尋到所有匯入的筆記
- 語義搜尋會理解您的問題意圖
- 找到最相關的法律知識

### ✅ RAG 問答增強
- AI 互動學習的「參考書模式」會更準確
- 可以引用您自己的筆記內容

### ✅ 知識庫完整
- 所有筆記都可以被搜尋到
- 不會遺漏任何重要內容

---

**執行完成後，您的智慧搜尋功能就完全啟用了！** 🎉
